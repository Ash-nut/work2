<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>主页</title>
    <!-- Element UI 的 CSS 文件 -->
    <link rel="stylesheet" href="../element-ui/lib/theme-chalk/index.css"/>
    <!-- 自定义样式文件 -->
    <link rel="stylesheet" href="/css/home.css">
    <!-- Vue 和 Element UI 的 JS 文件 -->
    <script type="text/javascript" src="../js/tool/vue.js"></script>
    <script type="text/javascript" src="../element-ui/lib/index.js"></script>
    <!-- axios -->
    <script type="text/javascript" src="../js/tool/axios.js"></script>
</head>
<body>
<div id="app">
    <el-container>
        <el-header id="header">
            <!-- 头部内容 -->
        </el-header>
        <el-container id="container">
            <el-aside id="aside">
                <!-- 侧边栏内容 -->
                <template>
                    <div>
                        <!-- 主菜单容器 -->
                        <el-menu
                                :default-active="activeIndex"
                                class="el-menu-vertical-demo"
                                @select="handleSelect"
                        >
                            <!-- 递归渲染菜单项 -->
                            <template v-for="(item, index) in menuData">
                                <menu-item :item="item" :key="item.id"></menu-item>
                            </template>
                        </el-menu>
                    </div>
                </template>
            </el-aside>
            <el-main>
                <!-- 主体内容 -->
                <iframe name="mainFrame" src="http://localhost:8080/page/sysPermManagePage.html" width="100%" height="100%"></iframe>
            </el-main>
        </el-container>
    </el-container>
</div>

<script>
    Vue.component('menu-item', {
        props: ['item'],
        template: `
          <el-submenu v-if="item.children && item.children.length" :index="item.id">
            <template #title>
              <span>{{ item.permName }}</span>
            </template>
            <menu-item v-for="child in item.children" :key="child.id" :item="child"></menu-item>
          </el-submenu>
          <el-menu-item v-else :index="item.id">
            <span>{{ item.permName }}</span>
          </el-menu-item>
        `
    });

    new Vue({
        el: '#app',
        data: {
            activeIndex: '1', // 默认激活的菜单项索引
            menuData: []
        },
        methods: {
            handleSelect(key, keyPath) {
                // 设置 iframe 的 src
                const selectedItem = this.findMenuItemById(this.menuData, key);
                if (selectedItem && selectedItem.route) {
                    document.querySelector('iframe[name="mainFrame"]').src = selectedItem.route;
                }
            },
            findMenuItemById(menuData, id) {
                for (let item of menuData) {
                    if (item.id === id) {
                        return item;
                    }
                    if (item.children && item.children.length) {
                        const found = this.findMenuItemById(item.children, id);
                        if (found) {
                            return found;
                        }
                    }
                }
                return null;
            },
            createRoleMenu(){
                console.log("创建角色菜单");
                axios.post('/LoginController/createRoleMenu',{

                }).then(res=>{
                    console.log(res.data.data);
                    this.menuData = res.data.data;
                });
            }
        },
        created() {
            // 获取菜单数据
            this.createRoleMenu();
        }
    });
</script>
</body>
</html>
